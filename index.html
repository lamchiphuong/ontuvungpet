<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√îN T·∫¨P T·ª™ V·ª∞NG TI·∫æNG ANH</title>
    
    <!-- Open Graph / Preview khi chia s·∫ª link -->
    <meta property="og:title" content="√îN T·∫¨P T·ª™ V·ª∞NG TI·∫æNG ANH">
    <meta property="og:description" content="H√£y √¥n t·∫≠p t·ª´ v·ª±ng ti·∫øng Anh b·∫±ng c√°ch kh√¥ng ƒë·ªÉ ch·ªØ r∆°i m·∫•t.">
    <meta property="og:image" content="https://cdn-icons-png.flaticon.com/512/10431/10431322.png">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/5780/5780484.png" type="image/png">
    
    <style>
        * { box-sizing: border-box; }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(to bottom, #a0e7ff, #ffffff);
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }
        h1 {
            color: #1e3d59;
            margin: 10px 0;
            font-size: 28px;
        }
        #score, #progress, #message {
            margin: 5px 0;
            font-size: 24px;
        }
        #progress {
            font-weight: bold;
            color: #4a90e2;
        }
        #message {
            min-height: 35px;
            font-weight: bold;
        }
        #game-area {
            margin: 10px auto;
            width: 700px;
            max-width: 95vw;
            height: 350px;
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            background: #ffffff;
        }
        #vietnamese-word {
            position: absolute;
            font-size: 40px;
            font-weight: bold;
            color: #1e3d59;
            left: 50%;
            transform: translateX(-50%);
            top: -80px;
            animation: fall linear forwards;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            white-space: nowrap;
        }
        @keyframes fall {
            to { top: 370px; }
        }
        #timer {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 30px;
            font-weight: bold;
            color: #e74c3c;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }
        #input-area {
            margin: 10px auto;
            padding: 15px;
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            width: 700px;
            max-width: 95vw;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #letters-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 100%;
        }
        .letter-box {
            width: 50px;
            height: 60px;
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            line-height: 60px;
            margin: 6px;
            border: 3px solid #4a90e2;
            border-radius: 10px;
            background-color: #f0f8ff;
            color: #1e3d59;
            transition: all 0.2s;
            text-transform: uppercase;
            flex-shrink: 0;
        }
        .letter-box.filled {
            background-color: #4a90e2;
            color: white;
        }
        .letter-box.correct {
            background-color: #2ecc71;
            border-color: #27ae60;
        }
        .letter-box.wrong {
            background-color: #e74c3c;
            border-color: #c0392b;
        }
        .letter-box.space {
            background-color: #bdc3c7;
            border-color: #95a5a6;
            color: #7f8c8d;
        }
        .letter-box.hint {
            background-color: #f39c12;
            border-color: #e67e22;
            color: white;
        }
        #hidden-input {
            position: absolute;
            left: -9999px;
        }
        #start-btn, #hint-btn {
            font-size: 22px;
            padding: 12px 30px;
            margin: 10px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(74,144,226,0.4);
            transition: 0.3s;
        }
        #hint-btn {
            background: #f39c12;
            display: none;
        }
        #start-btn:hover, #hint-btn:hover {
            transform: translateY(-3px);
        }
        #overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 100;
        }
        #result-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 101;
            display: none;
            max-width: 90%;
            width: 500px;
        }
        #result-popup h2 {
            font-size: 36px;
            color: #1e3d59;
            margin: 0 0 20px;
        }
        #result-popup p {
            font-size: 24px;
            margin: 15px 0;
        }
        #play-again-btn {
            font-size: 20px;
            padding: 12px 30px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>√în T·ª´ V·ª±ng Ti·∫øng Anh - ƒê·ª™NG ƒê·ªÇ T·ª™ R∆†I</h1>
    <button id="start-btn">B·∫Øt ƒê·∫ßu</button>
    <div id="score">ƒêi·ªÉm: 0</div>
    <div id="progress">T·ª´ ƒë√£ l√†m: 0 / 0</div>
    <div id="message"></div>
    <div id="game-area"></div>
    <div id="input-area">
        <div id="letters-container"></div>
    </div>
    <button id="hint-btn">G·ª£i √Ω</button>
    <input type="text" id="hidden-input" autocomplete="off">

    <div id="overlay"></div>
    <div id="result-popup">
        <h2>üéâ Ho√†n Th√†nh! üéâ</h2>
        <p id="final-score"></p>
        <p id="hint-count"></p>
        <p id="total-time"></p>
        <button id="play-again-btn">Ch∆°i L·∫°i</button>
    </div>

    <script>
        const originalWords = [
            { "vi": "l·∫∑n", "en": "dive" },
            { "vi": "l√†m", "en": "do" },
            { "vi": "ƒëi", "en": "go" },
            { "vi": "ch∆°i", "en": "play" },
            { "vi": "ƒëƒÉng (b√†i)", "en": "post" },
            { "vi": "ƒëi xe / c∆∞·ª°i", "en": "ride" },
            { "vi": "nh√¨n th·∫•y", "en": "see" },
            { "vi": "l·∫•y / mang", "en": "take" },
            { "vi": "·ªü tr√™n", "en": "above" },
            { "vi": "·ªü ph√≠a sau", "en": "behind" },
            { "vi": "·ªü ph√≠a tr∆∞·ªõc", "en": "in front of" },
            { "vi": "·ªü b√™n trong", "en": "inside" },
            { "vi": "·ªü b√™n c·∫°nh", "en": "next to" },
            { "vi": "·ªü tr√™n (ti·∫øp x√∫c)", "en": "on" },
            { "vi": "·ªü b√™n ph·∫£i", "en": "on the right" },
            { "vi": "ƒë·ªëi di·ªán", "en": "opposite" },
            { "vi": "·ªü ph√≠a d∆∞·ªõi", "en": "under" },
            { "vi": "c√≥ kh·∫£ nƒÉng chi tr·∫£", "en": "afford" },
            { "vi": "ƒë·ªìng √Ω", "en": "agree" },
            { "vi": "quy·∫øt ƒë·ªãnh", "en": "decide" },
            { "vi": "th√≠ch / t·∫≠n h∆∞·ªüng", "en": "enjoy" },
            { "vi": "th√≠ch / mu·ªën (kh√¥ng trang tr·ªçng)", "en": "fancy" },
            { "vi": "c·∫£m th·∫•y mu·ªën", "en": "feel like" },
            { "vi": "ho√†n th√†nh / k·∫øt th√∫c", "en": "finish" },
            { "vi": "hy v·ªçng", "en": "hope" },
            { "vi": "h·ªçc / h·ªçc c√°ch", "en": "learn" },
            { "vi": "phi·ªÅn / b·∫≠n t√¢m", "en": "mind" },
            { "vi": "nh·ªõ / b·ªè l·ª°", "en": "miss" },
            { "vi": "luy·ªán t·∫≠p", "en": "practise" },
            { "vi": "h·ª©a", "en": "promise" },
            { "vi": "mu·ªën", "en": "want" },
            { "vi": "mu·ªën (l·ªãch s·ª±)", "en": "would like" },
            { "vi": "b·ªã h·ªèng, tr·ª•c tr·∫∑c (m√°y m√≥c, xe c·ªô)", "en": "break down" },
            { "vi": "gi·ªëng ai ƒë√≥ trong gia ƒë√¨nh", "en": "take after" },
            { "vi": "ƒÉn m·∫∑c ƒë·∫πp, di·ªán ƒë·ªì", "en": "dress up" },
            { "vi": "ng∆∞·ª°ng m·ªô, k√≠nh tr·ªçng", "en": "look up to" },
            { "vi": "chƒÉm s√≥c, tr√¥ng nom", "en": "look after" },
            { "vi": "khoe khoang", "en": "show off" },
            { "vi": "c√≥ m·ªëi quan h·ªá t·ªët v·ªõi", "en": "get on with" },
            { "vi": "ƒëƒÉng k√Ω tham gia", "en": "sign up for" },
            { "vi": "mong ch·ªù, h√°o h·ª©c", "en": "look forward to" },
            { "vi": "t·ª´ b·ªè", "en": "give up" },
            { "vi": "b·∫Øt ƒë·∫ßu (s·ªü th√≠ch, th·ªÉ thao)", "en": "take up" },
            { "vi": "tham gia (ho·∫°t ƒë·ªông chung)", "en": "join in" },
            { "vi": "ghi t√™n xu·ªëng, ƒëƒÉng k√Ω", "en": "put down" },
            { "vi": "kh·ªüi h√†nh", "en": "set off" },
            { "vi": "ti·∫øp t·ª•c", "en": "go on" },
            { "vi": "reo, k√™u (chu√¥ng); n·ªï; h·ªèng", "en": "go off" },
            { "vi": "t√¨m ra, ph√°t hi·ªán ra", "en": "find out" },
            { "vi": "c·ªù vua", "en": "chess" },
            { "vi": "c·∫Øm tr·∫°i", "en": "camping" },
            { "vi": "n·∫•u ƒÉn", "en": "cooking" },
            { "vi": "ƒë·∫°p xe", "en": "cycling" },
            { "vi": "√¢m nh·∫°c", "en": "music" },
            { "vi": "v·∫Ω tranh", "en": "painting" },
            { "vi": "nhi·∫øp ·∫£nh", "en": "photography" },
            { "vi": "ba l√¥", "en": "backpack" },
            { "vi": "xe ƒë·∫°p", "en": "bike" },
            { "vi": "b√†n c·ªù", "en": "board" },
            { "vi": "c√¢y c·ªç v·∫Ω", "en": "brush" },
            { "vi": "m√°y ·∫£nh", "en": "camera" },
            { "vi": "ng∆∞·ªùi c·∫Øm tr·∫°i", "en": "camper" },
            { "vi": "ng∆∞·ªùi ch∆°i c·ªù vua", "en": "chess player" },
            { "vi": "ƒë·∫ßu b·∫øp", "en": "cook" },
            { "vi": "n·ªìi", "en": "cooker" },
            { "vi": "ng∆∞·ªùi ƒë·∫°p xe", "en": "cyclist" },
            { "vi": "m≈© b·∫£o hi·ªÉm", "en": "helmet" },
            { "vi": "nh·∫°c c·ª•", "en": "instrument" },
            { "vi": "nh·∫°c sƒ©", "en": "musician" },
            { "vi": "l√≤ n∆∞·ªõng", "en": "oven" },
            { "vi": "s∆°n / v·∫Ω", "en": "paint" },
            { "vi": "h·ªça sƒ© (v·∫Ω b·∫±ng m√†u n∆∞·ªõc, s∆°n)", "en": "painter" },
            { "vi": "nhi·∫øp ·∫£nh gia", "en": "photographer" },
            { "vi": "qu√¢n c·ªù", "en": "pieces" },
            { "vi": "l·ªÅu", "en": "tent" }
        ];

        let words = [];
        let currentWord = null;
        let score = 0;
        let hintCount = 0;
        let hintCountThisWord = 0;
        let totalLettersNeeded = 0;
        let hintedIndices = [];
        let completedCount = 0;
        let lastHintCompletedTheWord = false; // M·ªöI: ƒê√°nh d·∫•u l·∫ßn hint cu·ªëi c√≥ l√†m ho√†n th√†nh t·ª´ kh√¥ng
        const totalWords = originalWords.length;
        const duration = 30000;
        let startTime = null;
        let timerInterval = null;
        let timeoutId = null;

        const gameArea = document.getElementById('game-area');
        const lettersContainer = document.getElementById('letters-container');
        const hiddenInput = document.getElementById('hidden-input');
        const scoreDisplay = document.getElementById('score');
        const progressDisplay = document.getElementById('progress');
        const messageDisplay = document.getElementById('message');
        const startBtn = document.getElementById('start-btn');
        const hintBtn = document.getElementById('hint-btn');
        const overlay = document.getElementById('overlay');
        const resultPopup = document.getElementById('result-popup');
        const finalScoreText = document.getElementById('final-score');
        const hintCountText = document.getElementById('hint-count');
        const totalTimeText = document.getElementById('total-time');
        const playAgainBtn = document.getElementById('play-again-btn');

        let boxes = [];
        let timerDisplay = null;

        function updateProgress() {
            progressDisplay.textContent = `T·ª´ ƒë√£ l√†m: ${completedCount} / ${totalWords}`;
        }

        function startGame() {
            startBtn.style.display = 'none';
            hintBtn.style.display = 'inline-block';
            score = 0;
            hintCount = 0;
            completedCount = 0;
            scoreDisplay.textContent = 'ƒêi·ªÉm: 0';
            updateProgress();
            messageDisplay.textContent = '';
            words = [...originalWords];
            startTime = Date.now();
            nextWord();
        }

        function nextWord() {
            if (words.length === 0) {
                showResult();
                return;
            }

            const idx = Math.floor(Math.random() * words.length);
            currentWord = words[idx];
            words.splice(idx, 1);
            hintedIndices = [];
            hintCountThisWord = 0;
            lastHintCompletedTheWord = false;

            totalLettersNeeded = currentWord.en.replace(/ /g, '').length;

            gameArea.innerHTML = '';
            timerDisplay = document.createElement('div');
            timerDisplay.id = 'timer';
            gameArea.appendChild(timerDisplay);

            const wordEl = document.createElement('div');
            wordEl.id = 'vietnamese-word';
            wordEl.textContent = currentWord.vi;
            gameArea.appendChild(wordEl);
            wordEl.style.animation = `fall ${duration / 1000}s linear forwards`;

            lettersContainer.innerHTML = '';
            boxes = [];

            for (let i = 0; i < currentWord.en.length; i++) {
                const box = document.createElement('div');
                box.className = 'letter-box';
                if (currentWord.en[i] === ' ') {
                    box.classList.add('space');
                    box.textContent = '‚ê£';
                }
                lettersContainer.appendChild(box);
                boxes.push(box);
            }

            hiddenInput.value = '';
            hiddenInput.focus();
            updateBoxes();
            messageDisplay.textContent = '';

            let timeLeft = 30;
            timerDisplay.textContent = timeLeft;
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if (timeLeft <= 10) {
                    timerDisplay.style.color = '#ff0000';
                    timerDisplay.style.animation = 'pulse 0.8s infinite';
                }
            }, 1000);

            clearTimeout(timeoutId);
            timeoutId = setTimeout(revealAnswer, duration);
        }

        function updateBoxes() {
            const typed = hiddenInput.value.toUpperCase();
            let typedIndex = 0;

            boxes.forEach((box, boxIndex) => {
                if (currentWord.en[boxIndex] === ' ') return;

                const letterIndex = getLetterIndex(boxIndex);

                if (hintedIndices.includes(letterIndex)) {
                    box.textContent = currentWord.en[boxIndex].toUpperCase();
                    box.className = 'letter-box hint filled';
                } else {
                    const char = typed[typedIndex] || '';
                    box.textContent = char;
                    box.className = 'letter-box';
                    if (char) box.classList.add('filled');
                    typedIndex++;
                }
            });
        }

        function getLetterIndex(boxIndex) {
            let count = 0;
            for (let i = 0; i <= boxIndex; i++) {
                if (currentWord.en[i] !== ' ') count++;
            }
            return count - 1;
        }

        function giveHint() {
            const cleanAnswer = currentWord.en.replace(/ /g, '').toUpperCase();
            const currentTypedBefore = getCurrentTyped();

            // Ki·ªÉm tra xem tr∆∞·ªõc khi hint c√≥ ƒë·∫ßy ƒë·ªß ch∆∞a
            const wasCompleteBefore = currentTypedBefore === cleanAnswer;

            for (let i = 0; i < cleanAnswer.length; i++) {
                if (!hintedIndices.includes(i) && (currentTypedBefore[i] || '') !== cleanAnswer[i]) {
                    hintedIndices.push(i);
                    hintCount++;
                    hintCountThisWord++;
                    updateBoxes();
                    break;
                }
            }

            const currentTypedAfter = getCurrentTyped();

            // N·∫øu sau l·∫ßn hint n√†y m·ªõi ƒë·ªß t·ª´ ‚Üí ƒë√°nh d·∫•u l√† hint cu·ªëi ho√†n th√†nh
            if (!wasCompleteBefore && currentTypedAfter === cleanAnswer) {
                lastHintCompletedTheWord = true;
                checkAnswer(); // T·ª± ƒë·ªông ch·∫•m v√† qua t·ª´ m·ªõi
            }

            hiddenInput.focus();
        }

        function getCurrentTyped() {
            let result = '';
            let typedIndex = 0;

            for (let i = 0; i < currentWord.en.length; i++) {
                if (currentWord.en[i] === ' ') continue;

                const letterIndex = getLetterIndex(i);

                if (hintedIndices.includes(letterIndex)) {
                    result += currentWord.en[i].toUpperCase();
                } else {
                    result += (hiddenInput.value.toUpperCase()[typedIndex] || '');
                    typedIndex++;
                }
            }
            return result;
        }

        function completeCurrentWord() {
            completedCount++;
            updateProgress();
        }

        function checkAnswer() {
            if (!timeoutId) return;
            clearTimeout(timeoutId);
            clearInterval(timerInterval);
            timeoutId = null;

            const correct = currentWord.en.replace(/ /g, '').toUpperCase();
            const current = getCurrentTyped();

            if (current === correct && !lastHintCompletedTheWord) {
                // ƒê√∫ng v√† kh√¥ng ph·∫£i hint cu·ªëi ho√†n th√†nh ‚Üí + ƒëi·ªÉm
                score++;
                scoreDisplay.textContent = `ƒêi·ªÉm: ${score}`;
                messageDisplay.textContent = 'üéâ ƒê√∫ng r·ªìi! +1 ƒëi·ªÉm üéâ';
                messageDisplay.style.color = '#2ecc71';
                boxes.forEach(box => {
                    if (!box.classList.contains('space')) {
                        box.classList.remove('hint');
                        box.classList.add('correct');
                    }
                });
            } else if (current === correct && lastHintCompletedTheWord) {
                // ƒê√∫ng nh∆∞ng do hint cu·ªëi ho√†n th√†nh ‚Üí kh√¥ng ƒëi·ªÉm
                messageDisplay.textContent = '‚úÖ ƒê√∫ng nh∆∞ng d√πng g·ª£i √Ω ch·ªØ cu·ªëi ‚Äì Kh√¥ng t√≠nh ƒëi·ªÉm';
                messageDisplay.style.color = '#f39c12';
                boxes.forEach(box => {
                    if (!box.classList.contains('space')) {
                        box.classList.add('hint');
                    }
                });
            } else {
                messageDisplay.textContent = `‚ùå Sai r·ªìi! ƒê√°p √°n: ${currentWord.en}`;
                messageDisplay.style.color = '#e74c3c';
                boxes.forEach((box, i) => {
                    if (currentWord.en[i] !== ' ') {
                        box.textContent = currentWord.en[i].toUpperCase();
                        box.classList.remove('hint');
                        box.classList.add('wrong');
                    }
                });
            }

            completeCurrentWord();
            setTimeout(nextWord, lastHintCompletedTheWord ? 3000 : 2500);
        }

        function revealAnswer() {
            clearInterval(timerInterval);
            timeoutId = null;
            messageDisplay.textContent = `‚è∞ H·∫øt gi·ªù! ƒê√°p √°n: ${currentWord.en}`;
            messageDisplay.style.color = '#f39c12';

            boxes.forEach((box, i) => {
                if (currentWord.en[i] !== ' ') {
                    box.textContent = currentWord.en[i].toUpperCase();
                    box.style.backgroundColor = '#f39c12';
                    box.style.borderColor = '#e67e22';
                    box.style.color = 'white';
                    box.classList.remove('hint');
                }
            });

            completeCurrentWord();
            setTimeout(nextWord, 3000);
        }

        function showResult() {
            clearInterval(timerInterval);
            const totalTime = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(totalTime / 60);
            const seconds = totalTime % 60;
            const timeStr = `${minutes} ph√∫t ${seconds.toString().padStart(2, '0')} gi√¢y`;

            finalScoreText.innerHTML = `‚úÖ ƒê√∫ng (c√≥ ƒëi·ªÉm): <strong>${score}</strong> / ${totalWords}<br>‚ùå Sai/H·∫øt gi·ªù/G·ª£i √Ω ch·ªØ cu·ªëi: <strong>${totalWords - score}</strong>`;
            hintCountText.textContent = `üí° S·ªë l·∫ßn d√πng g·ª£i √Ω: ${hintCount}`;
            totalTimeText.textContent = `‚è± T·ªïng th·ªùi gian: ${timeStr}`;

            overlay.style.display = 'block';
            resultPopup.style.display = 'block';
            hintBtn.style.display = 'none';
        }

        hiddenInput.addEventListener('input', () => {
            const hintedCount = hintedIndices.length;
            const maxAllowedInput = totalLettersNeeded - hintedCount;

            if (hiddenInput.value.length > maxAllowedInput) {
                hiddenInput.value = hiddenInput.value.slice(0, maxAllowedInput);
            }

            updateBoxes();

            const currentTypedLength = getCurrentTyped().length;
            if (currentTypedLength === totalLettersNeeded) {
                lastHintCompletedTheWord = false; // N·∫øu t·ª± g√µ ƒë·ªß ‚Üí ch·∫Øc ch·∫Øn kh√¥ng ph·∫£i hint cu·ªëi
                checkAnswer();
            }
        });

        hiddenInput.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                const currentTypedLength = getCurrentTyped().length;
                if (currentTypedLength > 0 && currentTypedLength <= totalLettersNeeded) {
                    lastHintCompletedTheWord = false;
                    checkAnswer();
                }
            }
        });

        hintBtn.addEventListener('click', giveHint);
        startBtn.addEventListener('click', startGame);
        playAgainBtn.addEventListener('click', () => {
            overlay.style.display = 'none';
            resultPopup.style.display = 'none';
            startGame();
        });

        gameArea.addEventListener('click', () => hiddenInput.focus());
        lettersContainer.addEventListener('click', () => hiddenInput.focus());
    </script>
</body>
</html>
